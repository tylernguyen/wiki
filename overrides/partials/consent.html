<!-- LINK Modifies https://github.com/zensical/ui/blob/master/src/partials/consent.html
     Copyright (c) 2025 Zensical and contributors
     SPDX-License-Identifier: MIT
-->

<!-- Render cookie checkbox -->
{% macro render_cookie(cookie, type) %}
  {% set checked = "" %}

  <!-- Cookie with defaults -->
  {% if cookie is string %}
    {% set name = cookie %}
    {% set checked = "checked" %}

  <!-- Cookie with settings -->
  {% else %}
    {% set name = cookie.name %}
    {% if cookie.checked %}
      {% set checked = "checked" %}
    {% endif %}
  {% endif %}
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="{{ type }}" {{ checked }}>
      <span class="task-list-indicator"></span>
      {{ name }}
    </label>
  </li>
{% endmacro %}

<!-- ---------------------------------------------------------------------- -->

<!-- Determine actions -->
{% set actions = config.extra.consent.actions %}
{% if not actions %}
  {% set actions = ["accept", "manage"] %}
{% endif %}

<!-- Determine initial settings state -->
{% if "manage" not in actions %}
  {% set checked = "checked" %}
{% endif %}

<!-- Consent title -->
<h4>{{ config.extra.consent.title }}</h4>
<img src="https://assets.tylernguyen.wiki/logos/PostHog-light.svg#only-light" alt="PostHog" width="250">
<img src="https://assets.tylernguyen.wiki/logos/PostHog-dark.svg#only-dark" alt="PostHog" width="250">
<p>{{ config.extra.consent.description }}</p>

<!-- Consent settings -->
<input
  class="md-toggle"
  type="checkbox"
  id="__settings"
  {{ checked }}
/>
<div class="md-consent__settings">
  <ul class="task-list">
    {% set cookies = config.extra.consent.cookies %}

    <!-- Google Analytics cookie, it not set -->
    {% if "analytics" not in cookies %}
      {% if config.extra.analytics %}
        {{ render_cookie("Google Analytics", "analytics") }}
      {% endif %}
    {% endif %}

    <!-- GitHub cookie, if not set -->
    {% if "github" not in cookies %}
      {% if config.repo_url and "github.com" in config.repo_url %}
        {{ render_cookie("GitHub", "github") }}
      {% endif %}
    {% endif %}

    <!-- Configured cookies-->
    {% for type in cookies %}
      {% if cookies[type] %}
        {{ render_cookie(cookies[type], type) }}
      {% endif %}
    {% endfor %}
  </ul>
</div>

<!-- Consent controls -->
<div class="md-consent__controls">
  {% for action in actions %}

    <!-- Button to accept cookies -->
    {% if action == "accept" %}
      <button class="md-button md-button--primary">
        {{- lang.t("consent.accept") -}}
      </button>
    {% endif %}

    <!-- Button to reject cookies -->
    {% if action == "reject" %}
      <button type="reset" class="md-button md-button--primary">
        {{- lang.t("consent.reject") -}}
      </button>
    {% endif %}

    <!-- Button to manage settings -->
    {% if action == "manage" %}
      <label class="md-button" for="__settings">
        {{- lang.t("consent.manage") -}}
      </label>
    {% endif %}
  {% endfor %}
</div>
